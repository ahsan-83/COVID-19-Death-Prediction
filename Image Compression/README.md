# Image Compression : K-means Clustering

<img src="https://raw.githubusercontent.com/ahsan-83/Machine-Learning-Projects/main/Image%20Compression/images/k_means_clustering.png" width="600">

K-means clustering algorithm is implemented to compress image in this project. [Notebook](https://nbviewer.org/github/ahsan-83/Machine-Learning-Projects/blob/main/Image%20Compression/notebook/Image_Compression.ipynb)

## K-means Clustering Algorithm

K-means is a clustering algorithm to automatically partition $N$ data points into $K$ clusters where each data point belongs to the cluster with the nearest mean (cluster centroid). Cluster centroids are choosen such as squared Euclidean distance with each data point is minimized. 

- K-means is an iterative procedure that initates with random centroids.
- In each step assign each data point to their closest centroids.
- Recompute the mean of each centroid using the points assigned to it

```python
% Initialize centroids
centroids = kMeansInitCentroids(X, K) 

for iter = 1:iterations
    % Assign each data point to the closest centroid 
    idx = findClosestCentroids(X, centroids)
    
    % Compute means based on centroid assignments
    centroids = computeMeans(X, idx, K);
end
```

<img src="https://raw.githubusercontent.com/ahsan-83/Machine-Learning-Projects/main/Image%20Compression/images/k_means.gif" width="600">


**Random Centroid Initialization**

K-means clustering centroids are initialized by selecting random points from data set as implemented in `kMeansInitCentroids`.

Randomly permutes data points and select first K from random permutation set

```python
% Randomly reorder the indices of data points
randidx = randperm(size(X, 1))

% Select first K data points as centroids
centroids = X(randidx(1:K), :)
```

**Finding Closest Centroids**

In K-means clustering, each data point $x^{(i)}$ is assigned to its closest centroid as implemented in `findClosestCentroids`

$$ c^{(i)} = j\: that\: minimizes\: ||x^{(i)} − \mu_{j}||^2$$

- $c^{(i)}$ : Index of the centroid closest to $x^{(i)}$
- $\mu_{j}$ : Value of $j$th centroid.
- $||x^{(i)} − \mu_{j}||^2$ : Squared Euclidean distance between  $x^{(i)}$ and  $\mu_{j}$

**Compute Centroid Means**

K-means clustering each centroid is recomputed by taking mean of the data points assigned to it, as implemented in `computeMeanCentroids`

$$\mu_{k} = \frac{1}{|C_{k}|} \sum_{i \epsilon C_{k}} x^{(i)}$$

- $C_{k}$ : Data points assigned to centroid k
- $\mu_{k}$ : Mean of data points assigned to centroid k

**K-means Clustering** 

K-means clustering algorithm is implemented in `kMeanClustering` using above functions.

Default clustering iteration : 10

<a name='section3'></a>

## Image Compression with K-means

In a 24-bit color representation of an image, each pixel is represented as three 8-bit unsigned integers (ranging from 0 to 255) specifically Red, Green and Blue intensity values which is known as RGB encoding. Every image contains thousands of colors and we can compress an Image by reducing the numbers of colors to 16 colors. Thus we will only store the RGB values of the 16 colors, and for each pixel we only need to store the index (4 bit to represent 16 color ) of assigned color.

K-means clustering algorithm is used to partition image pixel color values in to 16 clusters (color values) which will be used to represent the compressed image. So we run K-means clustering on image color values with K = 16.

**Process Image**

- Image data is normalized into range [0,1] after laoding
- Image data is reshaped from (width, height, 3) to (width * height, 3)

**Run K-means Clustering**

K-means algorithm may not always converge to ideal centroids and depends on the initialization of centroids. 

So, K-means algorithm is usually run multiple times with different random initializations and centroids which has lowest error are choosen. 

After processing image data, K-means clustering is run 20 times using `kMeanClustering` with parameter K = 16 and clustering iteration = 10.

**Clustering Error Analysis**

Optimum Clustering Error : 

**Generate Compressed Image**

After running K-means clustering for 20 times, centroids for image compression are choosen which has lowest error.

Compressed image is generated by assigning each pixel color from centroid colors to which the pixel color value is closest.

**Clustering Visualization**

RGB color values and centroids after K-means clustering is shown in scatter plot































